@using HungerGamesSimulator.Data
@using HungerGamesSimulator.Data.Metadata;
@inject IMessageCenter MessageCenter;

<div class="main">
  <h3>The 1st Annual Hunger Games</h3>
  <button @onclick="Simulate"> Continue </button>
  <div class="simulationText">
    @foreach ( var message in MessageCenter.GetMessages() )
    {
      <p> @message </p>
    }
  </div>
</div>

@code {

  [Parameter]
  public Game? World { get; set; }


  [Parameter]
  public bool Reset { get; set; }

  [Parameter]
  public EventCallback<Game?> WorldChanged { get; set; }

  [Parameter]
  public List<IMetaData> TributesMetaData { get; set; }

  protected override async Task OnInitializedAsync()
  {
    if ( World == null || Reset )
    {

      World = new Game( 5, 5, TributesMetaData, MessageCenter );
      await WorldChanged.InvokeAsync(World);
    }
  }

  private async Task Simulate()
  {
    World?.Simulate();
    await WorldChanged.InvokeAsync(World);
  }
}